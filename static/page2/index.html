<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>ElasticDog.com | The ballyhoo of Aaron Bull Schaefer</title>

	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />
	<link href="/stylesheets/print.css" media="print" rel="stylesheet" type="text/css" />

	<link rel="alternate" type="application/atom+xml" href="/feed/" title="ElasticDog.com Articles Feed" />

	<!-- Google Analytics -->
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-19272271-1']);
		_gaq.push(['_trackPageview']);

		(function() {
		 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		 })();
	 </script>
</head>

<body id="elasticdog-com">
<div id="header">
	<h1>
		<a href="/">ElasticDog.com</a><br />
		&hellip;the ballyhoo of <a href="/about/">Aaron Bull Schaefer</a>
	</h1>

	<h2>Survey my <a href="/projects/">Influence</a> or Peruse my <a href="/archives/">Relics</a></h2>

	<hr />
</div>

<div id="content">
	
<ul class="relativity">

	<li><a href="/page3/" class="prev" rel="prev">&larr; older articles</a></li>



	<li><a href="/" class="next" rel="next">newer articles &rarr;</a></li>

</ul>



	<h1 id="article1"><a href="/2010/11/porting-a-poker-hand-evaluator-from-c-to-factor/">Porting a Poker Hand Evaluator from C to Factor</a></h1>

	

	<p>To help teach myself <a href="http://factorcode.org/">Factor</a>, I started solving a lot of the problems at <a href="http://projecteuler.net/">Project Euler</a> and approached each one, not only as a way to learn a new language, but as a means of exploring unfamiliar programming/mathematical methods, structures, and algorithms. This article explains the process I went through to port a fairly complicated poker hand evaluation algorithm from C to Factor.</p>
<h2 id="problem54">Problem 54</h2>
<p>In order to solve <a href="http://projecteuler.net/index.php?section=problems&amp;id=54">Problem 54</a>, I needed to come up with a way to programatically determine the winner when comparing two poker hands. I had recently read an extensive <a href="http://www.codingthewheel.com/archives/poker-hand-evaluator-roundup">blog post covering various poker hand evaluators</a>, so I knew that I didn&#8217;t want to bother with a naive solution when there were much better options out there. After reading through the different techniques, one stood out to me in particular; it was a relatively small amount of code, it didn&#8217;t require a ton of storage space, and it was plenty fast&#8230;</p>
<h3 id="cactuskev">Cactus Kev&#8217;s Poker Hand Evaluator</h3>
<p>Through the power of mathematics (<a href="https://secure.wikimedia.org/wikipedia/en/wiki/Combinatorics">combinatorics</a> in particular), you can ascertain that out of all 2,598,960 possible poker hands (52 choose 5), there are actually only <a href="http://www.suffecool.net/poker/7462.html">7462 distinct hand values</a> that you need to be concerned with. The basic idea behind <a href="http://www.suffecool.net/poker/evaluator.html">Cactus Kev&#8217;s Poker Hand Evaluator</a> is that you can take advantage of this fact by storing a card&#8217;s representation in an efficient manner, do some basic bit twiddling, some multiplication (which is computationally cheap), add in a couple lookup tables, and you can determine a hand&#8217;s equivalence class value <em>very</em> quickly.</p>
<p>The key concept here is that each of a card&#8217;s possible 13 ranks (deuce through ace) is stored as a different prime number, and by multiplying a hand&#8217;s five prime numbers together, you&#8217;ll get a unique result that can then be used to determine that hand&#8217;s overall value. If you handle the special cases of flushes, straights, and high cards, the rest can be boiled down to a simple binary search. You can read the gory details at <a href="http://www.suffecool.net/poker/evaluator.html">Kevin Suffecool&#8217;s site</a>.</p>
<h2 id="porting">The Porting Process</h2>
<h3 id="constants">Bitfield Representation</h3>
<p>Each card will be stored as a <a href="http://en.wikipedia.org/wiki/Bitfield">bitfield</a>, inside of an interger that&#8217;s 4-bytes long:</p>
<p><!--
   cyan:   #339999;
   green:  #3A8D35;
   orange: #CB5910;
   tan:    #A9A487;
   yellow: #E2DA6E;
--></p>
<pre><code>+-------------------------------------+
| <span style="color:#A9A487">xxx</span><span style="color:#CB5910">bbbbb bbbbbbbb</span> <span style="color:#339999">ssss</span><span style="color:#E2DA6E">rrrr</span> <span style="color:#A9A487">xx</span><span style="color:#3A8D35">pppppp</span> |
+-------------------------------------+
  <span style="color:#A9A487">xxx</span><span style="color:#CB5910">AKQJT 98765432</span> <span style="color:#339999">CDHS</span><span style="color:#E2DA6E">rrrr</span> <span style="color:#A9A487">xx</span><span style="color:#3A8D35">pppppp</span>
  -----------------------------------
  <span style="color:#A9A487">000</span><span style="color:#CB5910">01000 00000000</span> <span style="color:#339999">0100</span><span style="color:#E2DA6E">1011</span> <span style="color:#A9A487">00</span><span style="color:#3A8D35">100101</span>  =  134236965  =  King of Diamonds
  <span style="color:#A9A487">000</span><span style="color:#CB5910">00000 00001000</span> <span style="color:#339999">0001</span><span style="color:#E2DA6E">0011</span> <span style="color:#A9A487">00</span><span style="color:#3A8D35">000111</span>  =     529159  =  Five of Spades
  <span style="color:#A9A487">000</span><span style="color:#CB5910">00010 00000000</span> <span style="color:#339999">1000</span><span style="color:#E2DA6E">1001</span> <span style="color:#A9A487">00</span><span style="color:#3A8D35">011101</span>  =   33589533  =  Jack of Clubs
</code></pre>
<ul>
	<li><code>x</code> = bit turned off, not used</li>
	<li><code>b</code> = bit turned on depending on rank of card</li>
	<li><code>s</code> = bit turned on depending on suit of card</li>
	<li><code>r</code> = rank of card (deuce = 0, trey = 1, four = 2, &#8230;, ace = 12)</li>
	<li><code>p</code> = prime number value of rank (deuce = 2, trey = 3, four = 5, &#8230;, ace = 41)</li>
</ul>
<p>For now, I&#8217;m going to ignore how we get cards into this particular format, but I&#8217;ll come back to that in a bit.</p>
<h3 id="constants">Constants</h3>
<p>Now that we have an efficient means of representing individual cards, we need to establish some basic constants to align with the above bitfield representation and overall hand values&#8230;</p>
<h4 id="constants-c">Constants In C:</h4>
<div class="highlight"><pre><code class="c"><span class="cp">#define CLUB     0x8000</span>
<span class="cp">#define DIAMOND  0x4000</span>
<span class="cp">#define HEART    0x2000</span>
<span class="cp">#define SPADE    0x1000</span>

<span class="cp">#define Deuce  0</span>
<span class="cp">#define Trey   1</span>
<span class="cp">#define Four   2</span>
<span class="cp">#define Five   3</span>
<span class="cp">#define Six    4</span>
<span class="cp">#define Seven  5</span>
<span class="cp">#define Eight  6</span>
<span class="cp">#define Nine   7</span>
<span class="cp">#define Ten    8</span>
<span class="cp">#define Jack   9</span>
<span class="cp">#define Queen  10</span>
<span class="cp">#define King   11</span>
<span class="cp">#define Ace    12</span>

<span class="cp">#define STRAIGHT_FLUSH   1</span>
<span class="cp">#define FOUR_OF_A_KIND   2</span>
<span class="cp">#define FULL_HOUSE       3</span>
<span class="cp">#define FLUSH            4</span>
<span class="cp">#define STRAIGHT         5</span>
<span class="cp">#define THREE_OF_A_KIND  6</span>
<span class="cp">#define TWO_PAIR         7</span>
<span class="cp">#define ONE_PAIR         8</span>
<span class="cp">#define HIGH_CARD        9</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value_str</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;&quot;</span><span class="p">,</span>
    <span class="s">&quot;Straight Flush&quot;</span><span class="p">,</span>
    <span class="s">&quot;Four of a Kind&quot;</span><span class="p">,</span>
    <span class="s">&quot;Full House&quot;</span><span class="p">,</span>
    <span class="s">&quot;Flush&quot;</span><span class="p">,</span>
    <span class="s">&quot;Straight&quot;</span><span class="p">,</span>
    <span class="s">&quot;Three of a Kind&quot;</span><span class="p">,</span>
    <span class="s">&quot;Two Pair&quot;</span><span class="p">,</span>
    <span class="s">&quot;One Pair&quot;</span><span class="p">,</span>
    <span class="s">&quot;High Card&quot;</span>
<span class="p">};</span>
</code></pre></div><h4 id="constants-factor">Constants In Factor:</h4>
<div class="highlight"><pre><code class="factor"><span class="no">CONSTANT: CLUB</span>     <span class="mi">8</span>
<span class="no">CONSTANT: DIAMOND</span>  <span class="mi">4</span>
<span class="no">CONSTANT: HEART</span>    <span class="mi">2</span>
<span class="no">CONSTANT: SPADE</span>    <span class="mi">1</span>

<span class="no">CONSTANT: DEUCE</span>  <span class="mi">0</span>
<span class="no">CONSTANT: TREY</span>   <span class="mi">1</span>
<span class="no">CONSTANT: FOUR</span>   <span class="mi">2</span>
<span class="no">CONSTANT: FIVE</span>   <span class="mi">3</span>
<span class="no">CONSTANT: SIX</span>    <span class="mi">4</span>
<span class="no">CONSTANT: SEVEN</span>  <span class="mi">5</span>
<span class="no">CONSTANT: EIGHT</span>  <span class="mi">6</span>
<span class="no">CONSTANT: NINE</span>   <span class="mi">7</span>
<span class="no">CONSTANT: TEN</span>    <span class="mi">8</span>
<span class="no">CONSTANT: JACK</span>   <span class="mi">9</span>
<span class="no">CONSTANT: QUEEN</span>  <span class="mi">10</span>
<span class="no">CONSTANT: KING</span>   <span class="mi">11</span>
<span class="no">CONSTANT: ACE</span>    <span class="mi">12</span>

<span class="no">CONSTANT: STRAIGHT_FLUSH</span>   <span class="mi">0</span>
<span class="no">CONSTANT: FOUR_OF_A_KIND</span>   <span class="mi">1</span>
<span class="no">CONSTANT: FULL_HOUSE</span>       <span class="mi">2</span>
<span class="no">CONSTANT: FLUSH</span>            <span class="mi">3</span>
<span class="no">CONSTANT: STRAIGHT</span>         <span class="mi">4</span>
<span class="no">CONSTANT: THREE_OF_A_KIND</span>  <span class="mi">5</span>
<span class="no">CONSTANT: TWO_PAIR</span>         <span class="mi">6</span>
<span class="no">CONSTANT: ONE_PAIR</span>         <span class="mi">7</span>
<span class="no">CONSTANT: HIGH_CARD</span>        <span class="mi">8</span>

<span class="no">CONSTANT: VALUE_STR</span> <span class="p">{</span> <span class="s2">&quot;Straight Flush&quot;</span> <span class="s2">&quot;Four of a Kind&quot;</span> <span class="s2">&quot;Full House&quot;</span> <span class="s2">&quot;Flush&quot;</span>
    <span class="s2">&quot;Straight&quot;</span> <span class="s2">&quot;Three of a Kind&quot;</span> <span class="s2">&quot;Two Pair&quot;</span> <span class="s2">&quot;One Pair&quot;</span> <span class="s2">&quot;High Card&quot;</span> <span class="p">}</span>
</code></pre></div><p>Here, the only difference I made in the Factor version was to start the hand value types at 0 instead of 1 to eliminate the empty string at index 0&#8230;it&#8217;s unnecessary.</p>
<h3 id="prime">Prime Number Representations</h3>
<p>As mentioned above, each card rank will be represented by its own prime number, so we&#8217;ll need a way to reference that&#8230;</p>
<h4 id="prime-c">Prime Numbers In C:</h4>
<div class="highlight"><pre><code class="c"><span class="kt">int</span> <span class="n">primes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">41</span> <span class="p">};</span>
</code></pre></div><h4 id="prime-factor">Prime Numbers In Factor:</h4>
<div class="highlight"><pre><code class="factor"><span class="no">CONSTANT: RANK_STR</span> <span class="p">{</span> <span class="s2">&quot;2&quot;</span> <span class="s2">&quot;3&quot;</span> <span class="s2">&quot;4&quot;</span> <span class="s2">&quot;5&quot;</span> <span class="s2">&quot;6&quot;</span> <span class="s2">&quot;7&quot;</span> <span class="s2">&quot;8&quot;</span> <span class="s2">&quot;9&quot;</span> <span class="s2">&quot;T&quot;</span> <span class="s2">&quot;J&quot;</span> <span class="s2">&quot;Q&quot;</span> <span class="s2">&quot;K&quot;</span> <span class="s2">&quot;A&quot;</span> <span class="p">}</span>

<span class="nf">: card-rank-prime </span><span class="kt">( rank -- n )</span>
    RANK_STR <span class="k">index </span><span class="p">{</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span> <span class="mi">13</span> <span class="mi">17</span> <span class="mi">19</span> <span class="mi">23</span> <span class="mi">29</span> <span class="mi">31</span> <span class="mi">37</span> <span class="mi">41</span> <span class="p">}</span> <span class="k">nth </span><span class="nf">;</span>
</code></pre></div><p>A minor change I made here was to establish a <code>RANK_STR</code> constant to make it easier to develop ways to parse and print card representations later (see the <a href="#printing-c">section on printing</a> below for the C equivalent). That said, <code>card-rank-prime</code> in the Factor version has the same purpose as the <code>primes</code> array in the C version, but it performs the lookup for you.</p>
<h3 id="initialize-card">Initializing Cards</h3>
<p>Now that we have some basic infrastructure in place, we can tackle initializing cards in the desired format. Cactus Kev&#8217;s code glosses over this process and only demonstrates how to generate an entire deck, so I&#8217;ll just cover the Factor code here&#8230;</p>
<h4 id="initialize-card-factor">Initializing Cards In Factor:</h4>
<div class="highlight"><pre><code class="factor"><span class="nf">: card-rank </span><span class="kt">( rank -- n )</span>
    <span class="p">{</span>
        <span class="p">{</span> <span class="s2">&quot;2&quot;</span> <span class="p">[</span> DEUCE <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;3&quot;</span> <span class="p">[</span> TREY  <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;4&quot;</span> <span class="p">[</span> FOUR  <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;5&quot;</span> <span class="p">[</span> FIVE  <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;6&quot;</span> <span class="p">[</span> SIX   <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;7&quot;</span> <span class="p">[</span> SEVEN <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;8&quot;</span> <span class="p">[</span> EIGHT <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;9&quot;</span> <span class="p">[</span> NINE  <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;T&quot;</span> <span class="p">[</span> TEN   <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;J&quot;</span> <span class="p">[</span> JACK  <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;Q&quot;</span> <span class="p">[</span> QUEEN <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;K&quot;</span> <span class="p">[</span> KING  <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;A&quot;</span> <span class="p">[</span> ACE   <span class="p">]</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">case </span><span class="nf">;</span>

<span class="nf">: card-suit </span><span class="kt">( suit -- n )</span>
    <span class="p">{</span>
        <span class="p">{</span> <span class="s2">&quot;C&quot;</span> <span class="p">[</span> CLUB    <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;D&quot;</span> <span class="p">[</span> DIAMOND <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;H&quot;</span> <span class="p">[</span> HEART   <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="s2">&quot;S&quot;</span> <span class="p">[</span> SPADE   <span class="p">]</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">case </span><span class="nf">;</span>

<span class="nf">: card-rank-bit </span><span class="kt">( rank -- n )</span>
    RANK_STR <span class="k">index </span><span class="mi">1</span> <span class="k">swap shift </span><span class="nf">;</span>

<span class="nf">: card-bitfield </span><span class="kt">( rank rank suit rank -- n )</span>
    <span class="p">{</span>
        <span class="p">{</span> card-rank-bit <span class="mi">16</span> <span class="p">}</span>
        <span class="p">{</span> card-suit <span class="mi">12</span> <span class="p">}</span>
        <span class="p">{</span> card-rank <span class="mi">8</span> <span class="p">}</span>
        <span class="p">{</span> card-rank-prime <span class="mi">0</span> <span class="p">}</span>
    <span class="p">}</span> bitfield <span class="nf">;</span>

<span class="nf">:: (&gt;ckf) </span><span class="kt">( rank suit -- n )</span>
    rank rank suit rank card-bitfield <span class="nf">;</span>

<span class="nf">: &gt;ckf </span><span class="kt">( string -- n )</span>
    <span class="c">#! Cactus Kev Format</span>
    &gt;upper <span class="mi">1</span> <span class="k">cut </span>(&gt;ckf) <span class="nf">;</span>

<span class="nf">: parse-cards </span><span class="kt">( string -- hand )</span>
    <span class="s2">&quot; &quot;</span> split <span class="p">[</span> &gt;ckf <span class="p">]</span> <span class="k">map </span><span class="nf">;</span>
</code></pre></div><p>To use this code, you&#8217;d start with a string representing a card, like <code>"AS"</code> for the Ace of Spades or <code>"7H"</code> for the Seven of Hearts, and then pass it to <code>&gt;ckf</code> to get its integer representation. The <code>parse-cards</code> word simply does this conversion for an entire hand; given a string like <code>"7C 5D 4H 3S 2C"</code>, it will output an array of the proper integers:</p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="s2">&quot;7C 5D 4H 3S 2C&quot;</span> parse-cards .
<span class="p">{</span> <span class="mi">2131213</span> <span class="mi">541447</span> <span class="mi">270853</span> <span class="mi">135427</span> <span class="mi">98306</span> <span class="p">}</span>
</code></pre></div><p>Due to Factor&#8217;s concatenative nature, you tend to write a lot of small words that do one specific thing, and then tie them together. Words are expected to be defined before you reference them (unless they&#8217;ve been <a href="http://docs.factorcode.org/content/article-deferred.html">deferred</a>), so when reading code from top to bottom, you&#8217;ll see big-picture words defined after the more-focused words they use. It&#8217;s also a convention to name helper words the same as the word from which they&#8217;re called, but with parentheses around the name.</p>
<p>One special thing to note is the use of <a href="http://docs.factorcode.org/content/word-__colon____colon__,locals.html">locals</a> in the <code>(&gt;ckf)</code> helper word&#8230;if you start a word definition with <code>::</code> instead of just <code>:</code>, Factor will bind the named inputs (from the stack declaration) to lexical variables from left to right. It&#8217;s used in this case because we need to pass these values to the <code>card-bitfield</code> word in a specific order, and <a href="/2008/12/beginning-factor-shufflers-and-combinators/#caveats">shufflers would make this a bit more confusing</a>.</p>
<p>The last thing to explain is the <code>card-bitfield</code> word itself&#8230;it looks up the proper bit values for the different parts of our card representation, and then constructs the final 4-byte integer from those values. See the <a href="http://docs.factorcode.org/content/word-bitfield,math.bitwise.html">bitfield documentation</a> for more details on its syntax.</p>
<h3 id="decks">Shuffling Decks and Printing Hands</h3>
<p>Initializing and shuffling a deck wasn&#8217;t strictly necessary for solving the Project Euler problem, but it was a useful abstraction and would be expected in a general poker library. Printing out a poker hand falls under this same category, but I&#8217;ve included it here as well since it was part of Cactus Kev&#8217;s original code. This is where the languages start to noticibly deviate in their implementations&#8230;</p>
<h4 id="init-deck-c">Initializing a Deck In C:</h4>
<div class="highlight"><pre><code class="c"><span class="n">init_deck</span><span class="p">(</span> <span class="kt">int</span> <span class="o">*</span><span class="n">deck</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">suit</span> <span class="o">=</span> <span class="mh">0x8000</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">suit</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">13</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">,</span> <span class="n">n</span><span class="o">++</span> <span class="p">)</span>
            <span class="n">deck</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">|</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">suit</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">16</span><span class="o">+</span><span class="n">j</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div><h4 id="init-deck-factor">Initializing a Deck In Factor:</h4>
<div class="highlight"><pre><code class="factor"><span class="nf">: &lt;deck&gt; </span><span class="kt">( -- deck )</span>
    RANK_STR SUIT_STR <span class="k">2array </span><span class="p">[</span> <span class="k">concat </span>&gt;ckf <span class="p">]</span> product-map <span class="nf">;</span>
</code></pre></div><h4 id="shuffle-c">Shuffling a Deck In C:</h4>
<div class="highlight"><pre><code class="c"><span class="kt">double</span>  <span class="nf">drand48</span><span class="p">();</span>

<span class="n">shuffle_deck</span><span class="p">(</span> <span class="kt">int</span> <span class="o">*</span><span class="n">deck</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">temp</span><span class="p">[</span><span class="mi">52</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">52</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">deck</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">52</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="mf">51.9999999</span> <span class="o">*</span> <span class="n">drand48</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span> <span class="n">temp</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">);</span>
        <span class="n">deck</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">temp</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h4 id="shuffle-factor">Shuffling a Deck In Factor:</h4>
<div class="highlight"><pre><code class="factor">ALIAS: shuffle randomize
</code></pre></div><h4 id="printing-c">Printing a Hand In C:</h4>
<div class="highlight"><pre><code class="c"><span class="n">print_hand</span><span class="p">(</span> <span class="kt">int</span> <span class="o">*</span><span class="n">hand</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">suit</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rank</span> <span class="o">=</span> <span class="s">&quot;23456789TJQKA&quot;</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">hand</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">hand</span> <span class="o">&amp;</span> <span class="mh">0x8000</span> <span class="p">)</span>
            <span class="n">suit</span> <span class="o">=</span> <span class="sc">&#39;c&#39;</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">hand</span> <span class="o">&amp;</span> <span class="mh">0x4000</span> <span class="p">)</span>
            <span class="n">suit</span> <span class="o">=</span> <span class="sc">&#39;d&#39;</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">hand</span> <span class="o">&amp;</span> <span class="mh">0x2000</span> <span class="p">)</span>
            <span class="n">suit</span> <span class="o">=</span> <span class="sc">&#39;h&#39;</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">suit</span> <span class="o">=</span> <span class="sc">&#39;s&#39;</span><span class="p">;</span>

        <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;%c%c &quot;</span><span class="p">,</span> <span class="n">rank</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">suit</span> <span class="p">);</span>
        <span class="n">hand</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h4 id="printing-factor">Printing a Hand In Factor:</h4>
<div class="highlight"><pre><code class="factor"><span class="nf">: &gt;card-rank </span><span class="kt">( card -- string )</span>
    <span class="mi">-8</span> <span class="k">shift </span><span class="mh">HEX: F</span> <span class="k">bitand </span>RANK_STR <span class="k">nth </span><span class="nf">;</span>

<span class="nf">: &gt;card-suit </span><span class="kt">( card -- string )</span>
    <span class="p">{</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">15</span> <span class="k">bit? </span><span class="p">]</span> <span class="p">[</span> <span class="k">drop </span><span class="s2">&quot;C&quot;</span> <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">14</span> <span class="k">bit? </span><span class="p">]</span> <span class="p">[</span> <span class="k">drop </span><span class="s2">&quot;D&quot;</span> <span class="p">]</span> <span class="p">}</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">13</span> <span class="k">bit? </span><span class="p">]</span> <span class="p">[</span> <span class="k">drop </span><span class="s2">&quot;H&quot;</span> <span class="p">]</span> <span class="p">}</span>
        <span class="p">[</span> <span class="k">drop </span><span class="s2">&quot;S&quot;</span> <span class="p">]</span>
    <span class="p">}</span> <span class="k">cond </span><span class="nf">;</span>

<span class="nf">: card&gt;string </span><span class="kt">( card -- string )</span>
    <span class="p">[</span> &gt;card-rank <span class="p">]</span> <span class="p">[</span> &gt;card-suit <span class="p">]</span> <span class="k">bi append </span><span class="nf">;</span>

<span class="nf">: print-hand </span><span class="kt">( hand -- )</span>
    <span class="p">[</span> card&gt;string <span class="p">]</span> <span class="k">map </span><span class="s2">&quot; &quot;</span> <span class="k">join print </span>flush;
</code></pre></div><p>I&#8217;m cheating a bit here with the <code>shuffle</code> word, as Factor already implements <code>randomize</code> using the <a href="http://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle">Fisher-Yates algorithm</a>; so rather than re-inventing the wheel, I just aliased the wheel. With Factor, you&#8217;ll also notice that count-controlled loops are much less common in comparison to using <a href="http://docs.factorcode.org/content/article-sequences.html">sequence operators</a> directly on the elements of a data structure.</p>
<h3 id="lookup">Lookup Tables</h3>
<p>We can almost get to the actual evaluation of hands to determine their relative value, but before that, we&#8217;ll need the proper lookup tables. These are all straight-forward arrays, and we have four to consider:</p>
<ol>
	<li>a table for all flushes (including straight flushes)</li>
	<li>a table for all non-flush hands consisting of five unique ranks (i.e. either straights or high card hands)</li>
	<li>a table of the product of prime values associated with a hand</li>
	<li>a table covering the final hand values of all hands not covered by the flushes/unique5 tables</li>
</ol>
<p>A zero means that specific combination is not possible for that type of hand&#8230;</p>
<h4 id="lookup-c">Lookup Tables In C:</h4>
<div class="highlight"><pre><code class="c"><span class="kt">short</span> <span class="n">flushes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1599</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1598</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1597</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1596</span><span class="p">,</span>
<span class="p">...</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="p">};</span>

<span class="kt">short</span> <span class="n">unique5</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1608</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7462</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7461</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">7460</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>
<span class="p">...</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
<span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1600</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">products</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="mi">48</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span>  <span class="mi">180</span><span class="p">,</span>  <span class="mi">200</span><span class="p">,</span>  <span class="mi">208</span><span class="p">,</span>  <span class="mi">252</span><span class="p">,</span>
<span class="mi">264</span><span class="p">,</span>  <span class="mi">270</span><span class="p">,</span> <span class="mi">272</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">368</span><span class="p">,</span> <span class="mi">378</span><span class="p">,</span> <span class="mi">392</span><span class="p">,</span> <span class="mi">396</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">408</span><span class="p">,</span>
<span class="mi">420</span><span class="p">,</span> <span class="mi">440</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">464</span><span class="p">,</span> <span class="mi">468</span><span class="p">,</span> <span class="mi">496</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">552</span><span class="p">,</span> <span class="mi">567</span><span class="p">,</span> <span class="mi">588</span><span class="p">,</span>  <span class="mi">592</span><span class="p">,</span>
<span class="p">...</span>
<span class="mi">66737381</span><span class="p">,</span>   <span class="mi">71339959</span><span class="p">,</span>  <span class="mi">73952233</span><span class="p">,</span>  <span class="mi">76840601</span><span class="p">,</span>  <span class="mi">79052387</span><span class="p">,</span>  <span class="mi">81947069</span><span class="p">,</span>
<span class="mi">85147693</span><span class="p">,</span> <span class="mi">87598591</span><span class="p">,</span> <span class="mi">94352849</span><span class="p">,</span> <span class="mi">104553157</span>
<span class="p">};</span>

<span class="kt">short</span>  <span class="n">values</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="mi">166</span><span class="p">,</span> <span class="mi">322</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">310</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">2467</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">2466</span><span class="p">,</span> <span class="mi">163</span><span class="p">,</span>  <span class="mi">3325</span><span class="p">,</span>  <span class="mi">321</span><span class="p">,</span>  <span class="mi">162</span><span class="p">,</span>
<span class="mi">3324</span><span class="p">,</span>  <span class="mi">2464</span><span class="p">,</span>  <span class="mi">2401</span><span class="p">,</span>  <span class="mi">161</span><span class="p">,</span>  <span class="mi">2465</span><span class="p">,</span> <span class="mi">3314</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">2461</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">2400</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span>
<span class="mi">3323</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">2457</span><span class="p">,</span> <span class="mi">6185</span><span class="p">,</span> <span class="mi">2463</span><span class="p">,</span> <span class="mi">3303</span><span class="p">,</span> <span class="mi">2452</span><span class="p">,</span>  <span class="mi">158</span><span class="p">,</span>  <span class="mi">3322</span><span class="p">,</span>  <span class="mi">157</span><span class="p">,</span>  <span class="mi">298</span><span class="p">,</span>
<span class="p">...</span>
<span class="mi">1676</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">2469</span><span class="p">,</span> <span class="mi">2468</span><span class="p">,</span> <span class="mi">1611</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">1610</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">11</span>
<span class="p">};</span>
</code></pre></div><h4 id="lookup-factor">Lookup Tables In Factor:</h4>
<div class="highlight"><pre><code class="factor"><span class="no">CONSTANT: flushes-table</span>
<span class="p">{</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1599</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1598</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1597</span> <span class="mi">0</span> <span class="mi">1596</span> <span class="mi">8</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1595</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1594</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1593</span> <span class="mi">0</span> <span class="mi">1592</span> <span class="mi">1591</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1590</span>
...
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="p">}</span>

<span class="no">CONSTANT: unique5-table</span>
<span class="p">{</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1608</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">7462</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">7461</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">7460</span> <span class="mi">0</span> <span class="mi">7459</span> <span class="mi">1607</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">7458</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">7457</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">7456</span> <span class="mi">0</span> <span class="mi">7455</span> <span class="mi">7454</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
...
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1600</span> <span class="p">}</span>

<span class="no">CONSTANT: products-table</span>
<span class="p">{</span> <span class="mi">48</span> <span class="mi">72</span> <span class="mi">80</span> <span class="mi">108</span> <span class="mi">112</span> <span class="mi">120</span> <span class="mi">162</span> <span class="mi">168</span> <span class="mi">176</span> <span class="mi">180</span> <span class="mi">200</span> <span class="mi">208</span> <span class="mi">252</span> <span class="mi">264</span> <span class="mi">270</span> <span class="mi">272</span> <span class="mi">280</span> <span class="mi">300</span> <span class="mi">304</span> <span class="mi">312</span>
<span class="mi">368</span> <span class="mi">378</span> <span class="mi">392</span> <span class="mi">396</span> <span class="mi">405</span> <span class="mi">408</span> <span class="mi">420</span> <span class="mi">440</span> <span class="mi">450</span> <span class="mi">456</span> <span class="mi">464</span> <span class="mi">468</span> <span class="mi">496</span> <span class="mi">500</span> <span class="mi">520</span> <span class="mi">552</span> <span class="mi">567</span> <span class="mi">588</span> <span class="mi">592</span> <span class="mi">594</span>
<span class="mi">612</span> <span class="mi">616</span> <span class="mi">630</span> <span class="mi">656</span> <span class="mi">660</span> <span class="mi">675</span> <span class="mi">680</span> <span class="mi">684</span> <span class="mi">696</span> <span class="mi">700</span> <span class="mi">702</span> <span class="mi">728</span> <span class="mi">744</span> <span class="mi">750</span> <span class="mi">760</span> <span class="mi">780</span> <span class="mi">828</span> <span class="mi">882</span> <span class="mi">888</span> <span class="mi">891</span>
...
<span class="mi">64379963</span> <span class="mi">64992503</span> <span class="mi">66233081</span> <span class="mi">66737381</span> <span class="mi">71339959</span> <span class="mi">73952233</span> <span class="mi">76840601</span> <span class="mi">79052387</span>
<span class="mi">81947069</span> <span class="mi">85147693</span> <span class="mi">87598591</span> <span class="mi">94352849</span> <span class="mi">104553157</span> <span class="p">}</span>

<span class="no">CONSTANT: values-table</span>
<span class="p">{</span> <span class="mi">166</span> <span class="mi">322</span> <span class="mi">165</span> <span class="mi">310</span> <span class="mi">164</span> <span class="mi">2467</span> <span class="mi">154</span> <span class="mi">2466</span> <span class="mi">163</span> <span class="mi">3325</span> <span class="mi">321</span> <span class="mi">162</span> <span class="mi">3324</span> <span class="mi">2464</span> <span class="mi">2401</span> <span class="mi">161</span> <span class="mi">2465</span>
<span class="mi">3314</span> <span class="mi">160</span> <span class="mi">2461</span> <span class="mi">159</span> <span class="mi">2400</span> <span class="mi">320</span> <span class="mi">3323</span> <span class="mi">153</span> <span class="mi">2457</span> <span class="mi">6185</span> <span class="mi">2463</span> <span class="mi">3303</span> <span class="mi">2452</span> <span class="mi">158</span> <span class="mi">3322</span> <span class="mi">157</span> <span class="mi">298</span>
<span class="mi">2460</span> <span class="mi">2446</span> <span class="mi">152</span> <span class="mi">3292</span> <span class="mi">156</span> <span class="mi">2398</span> <span class="mi">3321</span> <span class="mi">2462</span> <span class="mi">5965</span> <span class="mi">155</span> <span class="mi">6184</span> <span class="mi">309</span> <span class="mi">2456</span> <span class="mi">3320</span> <span class="mi">2439</span> <span class="mi">3313</span>
...
<span class="mi">1622</span> <span class="mi">191</span> <span class="mi">3546</span> <span class="mi">2490</span> <span class="mi">2470</span> <span class="mi">15</span> <span class="mi">2600</span> <span class="mi">25</span> <span class="mi">3326</span> <span class="mi">169</span> <span class="mi">24</span> <span class="mi">1612</span> <span class="mi">2479</span> <span class="mi">1677</span> <span class="mi">1621</span> <span class="mi">1676</span> <span class="mi">14</span> <span class="mi">168</span>
<span class="mi">2469</span> <span class="mi">2468</span> <span class="mi">1611</span> <span class="mi">23</span> <span class="mi">1610</span> <span class="mi">13</span> <span class="mi">179</span> <span class="mi">12</span> <span class="mi">167</span> <span class="mi">11</span> <span class="p">}</span>
</code></pre></div><h3 id="evaluation">Hand Evaluation</h3>
<p>Finally, we can get to the actual evaluation of hands&#8230;</p>
<h4 id="evaluation-c">Hand Evaluation In C:</h4>
<div class="highlight"><pre><code class="c"><span class="kt">int</span> <span class="nf">findit</span><span class="p">(</span> <span class="kt">int</span> <span class="n">key</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mi">4887</span><span class="p">,</span> <span class="n">mid</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="n">high</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">high</span><span class="o">+</span><span class="n">low</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>      <span class="c1">// divide by two</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">products</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">high</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="n">products</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">low</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="k">return</span><span class="p">(</span> <span class="n">mid</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fprintf</span><span class="p">(</span> <span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;ERROR:  no match found; key = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">key</span> <span class="p">);</span>
    <span class="k">return</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">short</span>
<span class="nf">eval_5cards</span><span class="p">(</span> <span class="kt">int</span> <span class="n">c1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c4</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c5</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">q</span><span class="p">;</span>
    <span class="kt">short</span> <span class="n">s</span><span class="p">;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span><span class="o">|</span><span class="n">c2</span><span class="o">|</span><span class="n">c3</span><span class="o">|</span><span class="n">c4</span><span class="o">|</span><span class="n">c5</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>

    <span class="cm">/* check for Flushes and StraightFlushes</span>
<span class="cm">    */</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">c1</span> <span class="o">&amp;</span> <span class="n">c2</span> <span class="o">&amp;</span> <span class="n">c3</span> <span class="o">&amp;</span> <span class="n">c4</span> <span class="o">&amp;</span> <span class="n">c5</span> <span class="o">&amp;</span> <span class="mh">0xF000</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">flushes</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="p">);</span>

    <span class="cm">/* check for Straights and HighCard hands</span>
<span class="cm">    */</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">unique5</span><span class="p">[</span><span class="n">q</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">s</span> <span class="p">)</span>  <span class="k">return</span> <span class="p">(</span> <span class="n">s</span> <span class="p">);</span>

    <span class="cm">/* let&#39;s do it the hard way</span>
<span class="cm">    */</span>
    <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c3</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c4</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c5</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="p">);</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">findit</span><span class="p">(</span> <span class="n">q</span> <span class="p">);</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">values</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h4 id="evaluation-factor">Hand Evaluation In Factor:</h4>
<div class="highlight"><pre><code class="factor"><span class="nf">: flush? </span><span class="kt">( hand -- ? )</span>
    <span class="mh">HEX: F000</span> <span class="p">[</span> <span class="k">bitand </span><span class="p">]</span> <span class="k">reduce </span><span class="mi">0</span> = <span class="k">not </span><span class="nf">;</span>

<span class="nf">: rank-bits </span><span class="kt">( hand -- q )</span>
    <span class="mi">0</span> <span class="p">[</span> <span class="k">bitor </span><span class="p">]</span> <span class="k">reduce </span><span class="mi">-16</span> <span class="k">shift </span><span class="nf">;</span>

<span class="nf">: lookup </span><span class="kt">( hand table -- value )</span>
    <span class="p">[</span> rank-bits <span class="p">]</span> <span class="k">dip nth </span><span class="nf">;</span>

<span class="nf">: prime-bits </span><span class="kt">( hand -- q )</span>
    <span class="p">[</span> <span class="mh">HEX: FF</span> <span class="k">bitand </span><span class="p">]</span> map-product <span class="nf">;</span>

<span class="nf">: hand-value </span><span class="kt">( hand -- value )</span>
    <span class="k">dup </span>flush? <span class="p">[</span> flushes-table lookup <span class="p">]</span> <span class="p">[</span>
        <span class="k">dup </span>unique5-table lookup <span class="k">dup </span><span class="mi">0</span> &gt; <span class="p">[</span> <span class="k">nip </span><span class="p">]</span> <span class="p">[</span>
            <span class="k">drop </span>prime-bits products-table sorted-index
            values-table <span class="k">nth</span>
        <span class="p">]</span> <span class="k">if</span>
    <span class="p">]</span> <span class="k">if </span><span class="nf">;</span>
</code></pre></div><p>Each language&#8217;s implementation checks for flushes first, then for hands with five unique ranks, and if all else fails, multiplies the primes together, searches for that product in a lookup table, and then uses that index to determine the hand&#8217;s final value. The <code>findit</code> function in C is the binary search, and once again I used Factor&#8217;s built-in libraries to do the same thing with the <a href="http://docs.factorcode.org/content/word-sorted-index,binary-search.html">sorted-index</a> word.</p>
<h3 id="ranking">Hand Ranking</h3>
<p>We&#8217;re basically done at this point&#8230;the hand with the lowest value (from 1 to 7462) wins. If the values are the same, the hands are tied. A simple comparison function can tell you which hand is best.</p>
<p>One last function that&#8217;s handy though, is the ability to output what that value actually means&#8230;</p>
<h4 id="ranking-c">Hand Ranking in C:</h4>
<div class="highlight"><pre><code class="c"><span class="kt">int</span>
<span class="nf">hand_rank</span><span class="p">(</span> <span class="kt">short</span> <span class="n">val</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">6185</span><span class="p">)</span> <span class="k">return</span><span class="p">(</span><span class="n">HIGH_CARD</span><span class="p">);</span>        <span class="c1">// 1277 high card</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">3325</span><span class="p">)</span> <span class="k">return</span><span class="p">(</span><span class="n">ONE_PAIR</span><span class="p">);</span>         <span class="c1">// 2860 one pair</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">2467</span><span class="p">)</span> <span class="k">return</span><span class="p">(</span><span class="n">TWO_PAIR</span><span class="p">);</span>         <span class="c1">//  858 two pair</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">1609</span><span class="p">)</span> <span class="k">return</span><span class="p">(</span><span class="n">THREE_OF_A_KIND</span><span class="p">);</span>  <span class="c1">//  858 three-kind</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">1599</span><span class="p">)</span> <span class="k">return</span><span class="p">(</span><span class="n">STRAIGHT</span><span class="p">);</span>         <span class="c1">//   10 straights</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">322</span><span class="p">)</span>  <span class="k">return</span><span class="p">(</span><span class="n">FLUSH</span><span class="p">);</span>            <span class="c1">// 1277 flushes</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">166</span><span class="p">)</span>  <span class="k">return</span><span class="p">(</span><span class="n">FULL_HOUSE</span><span class="p">);</span>       <span class="c1">//  156 full house</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>   <span class="k">return</span><span class="p">(</span><span class="n">FOUR_OF_A_KIND</span><span class="p">);</span>   <span class="c1">//  156 four-kind</span>
    <span class="k">return</span><span class="p">(</span><span class="n">STRAIGHT_FLUSH</span><span class="p">);</span>                   <span class="c1">//   10 straight-flushes</span>
<span class="p">}</span>
</code></pre></div><h4 id="ranking-factor">Hand Ranking in Factor:</h4>
<div class="highlight"><pre><code class="factor"><span class="nf">: value&gt;rank </span><span class="kt">( value -- rank )</span>
    <span class="p">{</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">6185</span> &gt; <span class="p">]</span> <span class="p">[</span> <span class="k">drop </span>HIGH_CARD <span class="p">]</span> <span class="p">}</span>        <span class="c">! 1277 high card</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">3325</span> &gt; <span class="p">]</span> <span class="p">[</span> <span class="k">drop </span>ONE_PAIR <span class="p">]</span> <span class="p">}</span>         <span class="c">! 2860 one pair</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">2467</span> &gt; <span class="p">]</span> <span class="p">[</span> <span class="k">drop </span>TWO_PAIR <span class="p">]</span> <span class="p">}</span>         <span class="c">!  858 two pair</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">1609</span> &gt; <span class="p">]</span> <span class="p">[</span> <span class="k">drop </span>THREE_OF_A_KIND <span class="p">]</span> <span class="p">}</span>  <span class="c">!  858 three-kind</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">1599</span> &gt; <span class="p">]</span> <span class="p">[</span> <span class="k">drop </span>STRAIGHT <span class="p">]</span> <span class="p">}</span>         <span class="c">!   10 straights</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">322</span> &gt; <span class="p">]</span>  <span class="p">[</span> <span class="k">drop </span>FLUSH <span class="p">]</span> <span class="p">}</span>            <span class="c">! 1277 flushes</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">166</span> &gt; <span class="p">]</span>  <span class="p">[</span> <span class="k">drop </span>FULL_HOUSE <span class="p">]</span> <span class="p">}</span>       <span class="c">!  156 full house</span>
        <span class="p">{</span> <span class="p">[</span> <span class="k">dup </span><span class="mi">10</span> &gt; <span class="p">]</span>   <span class="p">[</span> <span class="k">drop </span>FOUR_OF_A_KIND <span class="p">]</span> <span class="p">}</span>   <span class="c">!  156 four-kind</span>
        <span class="p">[</span> <span class="k">drop </span>STRAIGHT_FLUSH <span class="p">]</span>                      <span class="c">!   10 straight-flushes</span>
    <span class="p">}</span> <span class="k">cond </span><span class="nf">;</span>

<span class="nf">: string&gt;value </span><span class="kt">( string -- value )</span>
    parse-cards hand-value <span class="nf">;</span>

<span class="nf">: hand-rank </span><span class="kt">( string -- string )</span>
    string&gt;value value&gt;rank VALUE_STR <span class="k">nth </span><span class="nf">;</span>
</code></pre></div><p>Cactus Kev&#8217;s code didn&#8217;t include the code for explicit output of a string, but he did include the <code>value_str</code> array which could be used for this purpose.</p>
<h2 id="all-together">Putting it All Together</h2>
<p>To use the poker evaluator directly in Factor&#8217;s interactive listener environment, you can enter something like these examples:</p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="s2">&quot;7H 7S 7D AS AC&quot;</span> hand-rank .
<span class="s2">&quot;Full House&quot;</span>

(scratchpad) <span class="s2">&quot;7C 5D 4H 3S 2C&quot;</span> <span class="s2">&quot;KD QS JC TH 9S&quot;</span> <span class="p">[</span> string&gt;value <span class="p">]</span> <span class="k">bi@ </span>&gt; .
<span class="no">t</span>
</code></pre></div><h3 id="euler">Solving Problem 54</h3>
<p>Getting back to our original goal of solving Project Euler&#8217;s <a href="http://projecteuler.net/index.php?section=problems&amp;id=54">Problem 54</a>, we can now quite easily determine how many times <i>Player 1</i> wins out of 1000 random hands dealt to two players&#8230;</p>
<div class="highlight"><pre><code class="factor"><span class="nf">: source-054 </span><span class="kt">( -- seq )</span>
    <span class="s2">&quot;resource:extra/project-euler/054/poker.txt&quot;</span> ascii file-lines
    <span class="p">[</span> <span class="p">[</span> <span class="mi">14</span> <span class="k">head-slice </span><span class="p">]</span> <span class="p">[</span> <span class="mi">14</span> <span class="k">tail-slice* </span><span class="p">]</span> <span class="k">bi 2array </span><span class="p">]</span> <span class="k">map </span><span class="nf">;</span>

<span class="nf">: euler054 </span><span class="kt">( -- answer )</span>
    source-054 <span class="p">[</span> <span class="p">[</span> string&gt;value <span class="p">]</span> <span class="k">map first2 </span>before? <span class="p">]</span> <span class="k">count </span><span class="nf">;</span>
</code></pre></div><p>The <code>source-054</code> word simply converts the provided text file into the format our evaluator expects and the hand comparisons are subsequently handled by the <code>euler054</code> word and counted up! Let&#8217;s just say that <i>Player 2</i> is much better at poker :-)</p>
<h2 id="improvements">Vocabulary Improvements</h2>
<p>Since porting the initial version of the poker vocabulary, many improvements have been made to generalize the code for use beyond just solving Project Euler problems. I ended up dropping the binary search in favor of using the <a href="http://www.senzee5.com/2006/06/some-perfect-hash.html">Senzee Perfect Hash Optimization</a>, and other Factor contributors have added code specifically for Texas Hold&#8217;em and Omaha evaluation. I didn&#8217;t want to cover all of that here, as the focus of this article is the direct comparison between C and Factor, but you can view the <a href="https://github.com/slavapestov/factor/tree/master/extra/poker">current poker vocabulary</a> to see all of these enhancements.</p>
<p>As always, feel free to <a href="/about/#contact">drop me a line</a> if you&#8217;d like to discuss things further.</p>
	<hr />

	<h1 id="article2"><a href="/2010/11/magnetic-based-versus-flash-based-storage/">Magnetic-Based versus Flash-Based Storage</a></h1>

	

	<p>This article is the answer I wrote to an exam question for a basic cyber forensics course I took back in Feb 2009. I recently ran across this exam in my files and thought others might be interested in a high-level overview of the differences between <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Hard_disk_drive">magnetic-based</a> and <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Solid-state_drive">flash-based</a> storage technologies&#8230;</p>
<h2 id="question">The Question</h2>
<blockquote>
<p>&#8220;Briefly discuss the differences between magnetic-based storage and flash-based storage. What effect do these differences have on digital evidence investigations?&#8221;</p>
</blockquote>
<h2 id="answer">My Answer</h2>
<p>Between the two types of disk storage technology of magnetic-based and flash-based hard drives (<acronym title="Hard Disk Drive"><span class="caps">HDD</span></acronym>s and <acronym title="Solid-State Drive"><span class="caps">SSD</span></acronym>s respectively), magnetic-based drives are more common, with flash-based drives quickly gaining speed in development and adoption rates.</p>
<p>Magnetic-based drives use a series of stacked metal or glass disks called &#8220;platters&#8221;, which store microscopic magnetic information on concentric rings called &#8220;tracks&#8221;, which are further split into smaller &#8220;sectors&#8221; of 571 bytes each. A sector only holds 512 bytes of actual data and uses the remaining bytes for syncing purposes, a header with a location ID, and error detection via <acronym title="Cyclic Redundancy Check"><span class="caps">CRC</span></acronym> checksums. A magnetic read head hovers over the metal platters as they spin, and depending on the electrical impulses that motion creates, you get either a one or zero represented as binary data. A &#8220;cylinder&#8221; is the combined data for a single track on all of the platters in a drive (both sides of each platter). Once the data is read, on-board hardware decodes that information and transmits it to the computer via a standardized interface.</p>
<p>Flash-based drives are quite different. There are no physically moving parts, and they store data electronically instead of magnetically. Using a pair of transistor gates (a float gate and a control gate), flash-based storage sends electrical impulses to logically segmented areas in memory to store the appropriate ones and zeros in binary format (just like magnetic drives). Because they use only electricity and don&#8217;t have to wait for actuator arms to physically move heads into position for reads and writes, flash-based storage is typically much faster at I/O operations. Like magnetic drives, flash-based drives also have a built-in hardware controller to manage its operation and to convert the data into a standardized format to be read by the computer.</p>
<p>The effect each one of these has on a digital investigation is wide-spread. First of all, they both retain data for different amounts of time when left sitting. Magnetic data is not very reliable after a year or so, while flash-based data will usually last quite a bit longer. Flash-based memory also has a limited number of erase cycles, after which, whatever data is stored on that segment <em>will not</em> change. This can actually help in an investigation if you can trick the hardware controller into thinking it can no longer use the memory, you could essentially turn it into a read-only device and preserve evidence. Likewise, magnetic disks often have a residual magnetic signature of previous data, even if it has been overwritten. Sometimes these properties can be exploited by an expert lab with the proper equipment to recover data that was intentionally destroyed.</p>
<p>Both storage mediums will usually not overwrite data when it is deleted, but will simply update an allocation table to specify that a cluster or segment is free for writing again.</p>
<p>Keeping in mind how each of these technologies transforms physical properties into a common, logical storage interface can help you to make better decisions on how to preserve data, how to find evidence, and what to expect when doing an investigation. If you don&#8217;t pay attention to how these technologies differ, you have the potential to either miss important information, or in the worst case, destroy the information you do have.</p>
	<hr />

	<h1 id="article3"><a href="/2008/12/beginning-factor-shufflers-and-combinators/">Beginning Factor &#8211; Shufflers &amp; Combinators</a></h1>

	

	<p>In the <a href="/2008/11/beginning-factor-introduction/">previous installment</a> of Beginning Factor, we discussed some of the attributes of stack-based languages and the syntax for defining words in Factor. This time around, I&#8217;d like to introduce stack shufflers, quotations &amp; combinators, and touch on some more basic data types and their properties.</p>
<p>Up until now, we&#8217;ve essentially been using Factor as an overqualified <acronym title="Reverse Polish Notation"><span class="caps">RPN</span></acronym> calculator. I just wanted to make sure that you don&#8217;t underestimate Factor because of these particular examples; Factor is an extremely capable and modern language that can be used for everything from web applications, to game development, to complex text parsing, and so on. I&#8217;m purposefully using over-simplified examples as a means to demonstrate specific points about the language. Stick with me, and I assure you the examples will gradually get more expressive.</p>
<h2 id="shufflers">Stack Shufflers</h2>
<p>Because of Factor&#8217;s stack-based nature, you sometimes need the ability to rearrange or copy items in the stack to ensure that they are in the correct position for future use. The way to go about this is a group of words called &#8220;stack shufflers&#8221;.</p>
<p>Much like the name implies, stack shufflers are merely words that change the order (or number) of the items on the top of the stack. It is said that shuffle words &#8220;control the flow of data between words that perform actions.&#8221; In fact, you already know one stack shuffler&#8230; <code>drop</code></p>
<p>There are three basic varieties of stack shufflers. Here they are along with the most commonly used word for each type:</p>
<ol>
<li>
<p><strong>Removing Shufflers</strong></p>
<dl>
	<dt><code>drop</code> <i>( x &#45;&#45; )</i></dt>
	<dd>removes the top item from the stack and discards it</dd>
</dl>
</li>
<li>
<p><strong>Duplicating Shufflers</strong></p>
<dl>
	<dt><code>dup</code> <i>( x &#45;&#45; x x )</i></dt>
	<dd>duplicates the top item on the stack</dd>
</dl>
</li>
<li>
<p><strong>Permuting Shufflers</strong></p>
<dl>
	<dt><code>swap</code> <i>( x y &#45;&#45; y x )</i></dt>
	<dd>exchanges the positions of the first and second items on the top of the stack</dd>
</dl>
</li>
</ol>
<p><img src="/images/2008/12/stack-swap.png" title="Swapping Two Items on the Top of a Stack" alt="Swapping Two Items on the Top of a Stack" /></p>
<p>&#8230;and here are a couple of word definitions that use these shufflers appropriately:</p>
<div class="highlight"><pre><code class="factor"><span class="nf">: sq </span><span class="kt">( x -- y )</span>
    <span class="k">dup </span>* <span class="nf">;</span>

<span class="nf">: neg </span><span class="kt">( x -- -x )</span>
    <span class="mi">0</span> <span class="k">swap </span>- <span class="nf">;</span>
</code></pre></div><div class="highlight"><pre><code class="factor">(scratchpad) <span class="mi">5</span> <span class="k">sq </span>.
<span class="mi">25</span>
(scratchpad) <span class="mi">1</span> <span class="k">neg </span>.
<span class="mi">-1</span>
</code></pre></div><h3 id="caveats">Caveats</h3>
<p>There are many more <a href="http://docs.factorcode.org/content/article-shuffle-words.html">shuffle words</a> that support intricate rearrangements and the duplication/removal of multiple items from differing locations within the stack. The problem is, <em>code that is full of stack shufflers can easily become confusing</em>. In general, you should try to minimize the use of stack shufflers to keep things understandable.</p>
<p>Of course there are exceptions to that rule, times when shufflers make the most sense, but the <em>preferred</em> alternative to complicated stack shufflers is the use of a &#8220;combinator&#8221; that fits your use case. That said, combinators will take a bit of explaining&#8230;</p>
<h2 id="quotations">Quotations</h2>
<p>Before we can get to the idea of combinators, we first have to discuss quotations:</p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="mi">5</span> <span class="p">[</span> <span class="s2">&quot;hello&quot;</span> <span class="k">print </span><span class="p">]</span> <span class="k">times</span>
hello
hello
hello
hello
hello
</code></pre></div><p>In this example, <code>[ "hello" print ]</code> is a quotation.</p>
<p>In layman&#8217;s terms, a quotation is a way to encapsulate a snippet of code so it doesn&#8217;t get called right away, but can be passed around on the stack and called later. The computer science term for this is an &#8220;anonymous function&#8221;. It&#8217;s referred to as &#8220;anonymous&#8221; because it is fundamentally a word that has no name.</p>
<p>If we didn&#8217;t have quotations, that same example would get ugly real fast:</p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="s2">&quot;hello&quot;</span> <span class="k">dup dup dup dup print print print print print</span>
hello
hello
hello
hello
hello
</code></pre></div><p>Imagine if you wanted to print &#8220;hello&#8221; 1000 times!</p>
<p>To create a quotation, you just surround your code snippet with square brackets, and it will be pushed onto the stack: <code>[ ... ]</code>. In order to do anything useful with that quotation once it&#8217;s on the stack, what you need is a combinator.</p>
<h2 id="combinators">What is a Combinator?</h2>
<p>A combinator is just a fancy name for a word that takes a quotation as one of its inputs. In the example above, <code>times</code> is a combinator which takes an integer (<i>n</i>) and a quotation from the stack, and it calls that quotation <i>n</i> times.</p>
<p>Factor uses quotations &amp; combinators extensively for conditionals, sequence traversal, namespaces, closures, and more&#8230;but that&#8217;s jumping the gun a bit. Before we dive into all of that, I&#8217;d like to get back to the idea of minimizing the use of stack shufflers by replacing them with appropriate combinators instead.</p>
<h2 id="intent">Combinators That Express Intent</h2>
<p>While our code examples thus far have been easy to follow, when you start tackling more realistic problems, stack shufflers <em>will</em> begin to obfuscate your code. If we can represent our intentions consistently with a combinator instead, then code becomes cleaner and you can consequently focus more on your problem domain and less on mentally organizing your stack.</p>
<p>To illustrate this point, I&#8217;d like to introduce a couple of simple combinators:</p>
<dl>
	<dt><code>dip</code> <i>( x quot &#45;&#45; x )</i></dt>
	<dd>calls a quotation while temporarily hiding the top item on the stack</dd>
</dl>
<dl>
	<dt><code>keep</code> <i>( x quot &#45;&#45; x )</i></dt>
	<dd>calls a quotation with an item on the stack, restoring that item after the quotation returns</dd>
</dl>
<p>While both of these combinators have the same stack effect declaration, their usage is a bit different:</p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="mi">1</span> <span class="mi">2</span> <span class="mi">4</span> <span class="p">[</span> + <span class="p">]</span> <span class="k">dip</span>

--- Data stack:
<span class="mi">3</span>
<span class="mi">4</span>

(scratchpad) <span class="k">clear</span>
(scratchpad) <span class="mi">1</span> <span class="mi">2</span> <span class="mi">4</span> <span class="p">[</span> + <span class="p">]</span> <span class="k">keep</span>

--- Data stack:
<span class="mi">1</span>
<span class="mi">6</span>
<span class="mi">4</span>
</code></pre></div><p>These two combinators alone can greatly reduce the number of stack shufflers your code will need. If you&#8217;re curious about how these combinators work, they both secretly take advantage of an auxiliary stack (called the &#8220;retain stack&#8221;) to temporarily store items while the supplied quotation is being executed. There are a few other <a href="http://docs.factorcode.org/content/article-dip-keep-combinators.html">preserving combinators</a> that are worth exploring as well.</p>
<h3 id="cleave">Cleave, Spread, and Apply</h3>
<p>The cleave, spread, and apply combinators are your best weapons when trying to reduce the use of stack shufflers while simultaneously expressing intent. The key point being that they <em>should</em> express intent&#8230;if you find yourself writing code where these combinators don&#8217;t fit logically, then try another option.</p>
<ol>
<li>
<p><strong>Cleave Combinators</strong></p>
<p>These are used when you want to <em>apply multiple quotations to the same set of items</em> on the top of the stack.</p>
<p>Let&#8217;s say that you want to find the average of a bunch of numbers in an array. The steps are straightforward, you take the sum of all the numbers and divide that sum by how many numbers you have (the length of the array):</p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="p">{</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="p">}</span> <span class="k">dup sum swap length </span>/ .
<span class="mi">2</span>
</code></pre></div><p>We can eliminate the need for those stack shufflers and better express our intent by using a cleave combinator to achieve the same thing:</p>
<dl>
	<dt><code>bi</code> <i>( x p q &#45;&#45; )</i></dt>
	<dd>applies quotation <b><i>p</i></b> to <b><i>x</i></b>, then applies quotation <b><i>q</i></b> to <b><i>x</i></b></dd>
</dl>
<p><img src="/images/2008/12/cleave.png" alt="Cleave Combinator Demonstration" width="510" height="222" /></p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="p">{</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="p">}</span> <span class="p">[</span> <span class="k">sum </span><span class="p">]</span> <span class="p">[</span> <span class="k">length </span><span class="p">]</span> <span class="k">bi </span>/ .
<span class="mi">2</span>
</code></pre></div><p>The different <a href="http://docs.factorcode.org/content/article-cleave-combinators.html">cleave combinators</a> change either the number of quotations applied to your items (<code>bi</code> vs. <code>tri</code>), or the number of items used as input for your quotations (<code>bi</code> vs. <code>2bi</code>).</p>
</li>
<li>
<p><strong>Spread Combinators</strong></p>
<p>These are used when you want to <em>apply a different quotation to different items</em> on the top of the stack. The spread combinators are closely related to <code>dip</code>, but provide a bit more flexibility while also expressing intent.</p>
<p>Let&#8217;s say that you have two coordinate positions in the form of <code>{ x y }</code>, and you&#8217;d like to extract the x-coordinate from the first position, and the y-coordinate from the second position to form a new position with those values:</p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="p">{</span> <span class="mi">1</span> <span class="mi">2</span> <span class="p">}</span> <span class="p">{</span> <span class="mi">3</span> <span class="mi">4</span> <span class="p">}</span> <span class="k">swap first swap second 2array </span>.
<span class="p">{</span> <span class="mi">1</span> <span class="mi">4</span> <span class="p">}</span>
</code></pre></div><p>We can eliminate the need for those stack shufflers and better express our intent by using a spread combinator to achieve the same thing:</p>
<dl>
	<dt><code>bi*</code> <i>( x y p q &#45;&#45; )</i></dt>
	<dd>applies quotation <b><i>p</i></b> to <b><i>x</i></b>, then applies quotation <b><i>q</i></b> to <b><i>y</i></b></dd>
</dl>
<p><img src="/images/2008/12/spread.png" alt="Spread Combinator Demonstration" width="510" height="222" /></p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="p">{</span> <span class="mi">1</span> <span class="mi">2</span> <span class="p">}</span> <span class="p">{</span> <span class="mi">3</span> <span class="mi">4</span> <span class="p">}</span> <span class="p">[</span> <span class="k">first </span><span class="p">]</span> <span class="p">[</span> <span class="k">second </span><span class="p">]</span> <span class="k">bi* 2array </span>.
<span class="p">{</span> <span class="mi">1</span> <span class="mi">4</span> <span class="p">}</span>
</code></pre></div><p>When you want to do the same thing with more than two quotations/items, then using spread combinators eliminates the need for nested dips or shufflers and the added clarity becomes much more evident.</p>
<p>The different <a href="http://docs.factorcode.org/content/article-spread-combinators.html">spread combinators</a> change the number of quotations applied to the corresponding number of items on the stack (<code>bi*</code> vs. <code>tri*</code>).</p>
</li>
<li>
<p><strong>Apply Combinators</strong></p>
<p>These are used when you want to <em>apply a single quotation to multiple items</em> on the top of the stack.</p>
<p>Let&#8217;s say that you have two strings, each containing a name, and you want to see if those names are the same. In order to ignore case when doing the comparison, you decide to convert both strings to upper case before checking for equality:</p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="s2">&quot;john&quot;</span> <span class="s2">&quot;John&quot;</span> <span class="k">swap </span>&gt;upper <span class="k">swap </span>&gt;upper = .
<span class="no">t</span>
</code></pre></div><p>We can eliminate the need for those stack shufflers and better express our intent by using an apply combinator to achieve the same thing:</p>
<dl>
	<dt><code>bi@</code> <i>( x y quot &#45;&#45; )</i></dt>
	<dd>applies the quotation to <b><i>x</i></b>, then to <b><i>y</i></b></dd>
</dl>
<p><img src="/images/2008/12/apply.png" alt="Apply Combinator Demonstration" width="510" height="222" /></p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="s2">&quot;john&quot;</span> <span class="s2">&quot;John&quot;</span> <span class="p">[</span> &gt;upper <span class="p">]</span> <span class="k">bi@ </span>= .
<span class="no">t</span>
</code></pre></div><p>The different <a href="http://docs.factorcode.org/content/article-apply-combinators.html">apply combinators</a> change the number of items on the stack your quotation is applied to  (<code>bi@</code> vs. <code>tri@</code>).</p>
</li>
</ol>
<p>The cleave, spread, and apply combinators are all closely related; if you&#8217;re having trouble keeping them apart, try to memorize the naming convention:</p>
<ul>
	<li>If there is no suffix, it is a &#8220;cleave&#8221;</li>
	<li>If the suffix is *, it is a &#8220;spread&#8221;</li>
	<li>If the suffix is @, it is an &#8220;apply&#8221;</li>
</ul>
<p>Once you learn these combinators, you should be able to express almost any pattern of complicated stack shufflers. Note that there are also <a href="http://docs.factorcode.org/content/article-combinators.html">generic forms</a> for all of these combinators that can take additional inputs from the stack. If you find that you resort to using the generic forms more often then not, that&#8217;s usually a good indication that you should rethink your approach or put your data into a more appropriate structure.</p>
<h2 id="data">Data Type Details</h2>
<p>Before I turn you loose, I wanted to offer a few extra details about some of Factor&#8217;s basic data types&#8230;</p>
<h3 id="sequences">Sequences</h3>
<p>In the cleave and spread examples above, I was sneaky and used sequences without explaining them formally. A sequence is a <em>finite, ordered, collection of elements</em>. Any data type that implements the sequence mixin class (meaning a data type that knows its length and will let you set/get an element at a specific index) gains the ability to use the powerful built-in <a href="http://docs.factorcode.org/content/article-sequences.html">sequence operators</a>. Read through that documentation to get an idea on how to manipulate sequences and their elements.</p>
<p>Factor has many sequence types that you may already be familiar with, such as <a href="http://docs.factorcode.org/content/article-arrays.html">arrays</a> (fixed-size mutable sequences) and <a href="http://docs.factorcode.org/content/article-vectors.html">vectors</a> (resizable mutable sequences), but there are also other data types that you might not expect to be sequences, such as strings. In Factor, a string is merely an array of Unicode 5.0 code points.</p>
<p>Using the sequence operators and combinators together, you can create all sorts of powerful abstractions that I&#8217;ll talk more about next time. Here are a couple of examples to whet your appetite:</p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="p">{</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">[</span> <span class="k">even? </span><span class="p">]</span> <span class="k">filter </span>.
<span class="p">{</span> <span class="mi">2</span> <span class="mi">4</span> <span class="p">}</span>
(scratchpad) <span class="p">{</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="p">}</span> <span class="p">[</span> . <span class="p">]</span> <span class="k">each</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
(scratchpad) <span class="s2">&quot;Hello&quot;</span> <span class="p">[</span> alpha? <span class="p">]</span> <span class="k">all? </span>.
<span class="no">t</span>
(scratchpad) <span class="s2">&quot;Hello!!!&quot;</span> <span class="p">[</span> alpha? <span class="p">]</span> <span class="k">all? </span>.
<span class="no">f</span>
</code></pre></div><p>Keep in mind that in Factor, <strong>sequences are zero-based</strong>.</p>
<h3 id="numbers">Numbers</h3>
<p>So far, we have only used integers, but Factor also supports <a href="http://docs.factorcode.org/content/article-rationals.html">rational numbers</a> (fractions), <a href="http://docs.factorcode.org/content/article-floats.html">floats</a> (decimal approximations of a number), and <a href="http://docs.factorcode.org/content/article-complex-numbers.html">complex numbers</a> (imaginary numbers).</p>
<div class="highlight"><pre><code class="factor">(scratchpad) <span class="mi">100</span> <span class="mi">330</span> / .
<span class="m">10/33</span>
(scratchpad) <span class="m">5/4</span> <span class="m">1/2</span> + .
<span class="mi">1</span><span class="m">+3/4</span>
(scratchpad) <span class="m">5/4</span> <span class="mi">0</span><span class="mf">.5</span> + .
<span class="mi">1</span><span class="mf">.75</span>
(scratchpad) <span class="mi">2</span> <span class="mi">5</span> rect&gt; .
<span class="p">C{</span> <span class="mi">2</span> <span class="mi">5</span> <span class="p">}</span>
</code></pre></div><h4 id="iota">Iota</h4>
<p>One last thing that is going to come in handy, is a word for creating sequences from integers:</p>
<dl>
	<dt><code>iota</code> <i>( n &#45;&#45; iota )</i></dt>
	<dd>creates a sequence of length <b><i>n</i></b>, whose elements are its non-negative predecessors (i.e. 0 to <b><i>n</i></b>-1 inclusive)</dd>
</dl>
<p>This word can be very helpful when performing counted loops or other control flow statements. For example, the following two lines are equivalent:</p>
<div class="highlight"><pre><code class="factor"><span class="p">{</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="p">}</span> <span class="p">[</span> . <span class="p">]</span> <span class="k">each</span>
</code></pre></div><div class="highlight"><pre><code class="factor"><span class="mi">10</span> <span class="k">iota </span><span class="p">[</span> . <span class="p">]</span> <span class="k">each</span>
</code></pre></div><h2 id="next">Next Time</h2>
<p>Next time we&#8217;ll stick with a theme of &#8220;flow&#8221; and discuss control flow for your words and after that, the typical work flow when developing code with Factor. Hope you enjoyed this installment!</p>
	


<ul class="relativity">

	<li><a href="/page3/" class="prev" rel="prev">&larr; older articles</a></li>



	<li><a href="/" class="next" rel="next">newer articles &rarr;</a></li>

</ul>



</div>
<div id="footer">
	<hr />

	<ul>
	
		<li><a href="/">Home</a></li>
	
	
		<li><a href="/about/">About</a></li>
	
	
		<li><a href="/projects/">Projects</a></li>
	
	
		<li><a href="/archives/">Archives</a></li>
	
	</ul>

	<div id="syndication"><a href="http://feeds.elasticdog.com/elasticdog" title="Subscribe to ElasticDog.com's Syndication Feed"><img src="/images/feed-icon.png" alt="Syndication Feed Icon" /></a></div>

	<p>Copyright &copy; 2003&#8211;2013 Aaron Bull Schaefer &#8212; All Rights Reserved.</p>
</div>

</body>
</html>
